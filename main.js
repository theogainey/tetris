"use strict";(()=>{function v(){let e=["I","J","L","O","S","T","Z"],r=Math.floor(Math.random()*e.length);return e[r]}function w(e){return e==="I"||e==="O"}function p(){let e=v();return{typeCurrent:e,xCurrent:w(e)?5*o:4.5*o,yCurrent:-2*o}}function h(){let e=t.rotation+1;if(e===l[t.typeCurrent].offsets.length){t.rotation=0;return}t.rotation=e}var o=30,E=48,n={I:{position1:[[-2*o,-o],[-o,-o],[0,-o],[o,-o]],position2:[[0,-2*o],[0,-o],[0,0],[0,o]]},J:{position1:[[-1.5*o,-1.5*o],[-1.5*o,-.5*o],[-.5*o,-.5*o],[.5*o,-.5*o]],position2:[[-.5*o,-1.5*o],[.5*o,-1.5*o],[-.5*o,-.5*o],[-.5*o,.5*o]],position3:[[-1.5*o,-.5*o],[-.5*o,-.5*o],[.5*o,-.5*o],[.5*o,.5*o]],position4:[[-.5*o,-1.5*o],[-.5*o,-.5*o],[-.5*o,.5*o],[-1.5*o,.5*o]]},L:{position1:[[-1.5*o,-.5*o],[-.5*o,-.5*o],[.5*o,-.5*o],[.5*o,-1.5*o]],position2:[[-.5*o,-1.5*o],[-.5*o,-.5*o],[-.5*o,.5*o],[.5*o,.5*o]],position3:[[-1.5*o,-.5*o],[-1.5*o,.5*o],[-.5*o,-.5*o],[.5*o,-.5*o]],position4:[[-1.5*o,-1.5*o],[-.5*o,-1.5*o],[-.5*o,-.5*o],[-.5*o,.5*o]]},O:{position1:[[-o,-o],[0,-o],[-o,0],[0,0]]},S:{position1:[[-1.5*o,-.5*o],[-.5*o,-.5*o],[-.5*o,-1.5*o],[.5*o,-1.5*o]],position2:[[-.5*o,-1.5*o],[-.5*o,-.5*o],[.5*o,-.5*o],[.5*o,.5*o]]},T:{position1:[[-1.5*o,-.5*o],[-.5*o,-.5*o],[-.5*o,-1.5*o],[.5*o,-.5*o]],position2:[[-.5*o,-1.5*o],[-.5*o,-.5*o],[.5*o,-.5*o],[-.5*o,.5*o]],position3:[[-1.5*o,-.5*o],[-.5*o,-.5*o],[.5*o,-.5*o],[-.5*o,.5*o]],position4:[[-1.5*o,-.5*o],[-.5*o,-1.5*o],[-.5*o,-.5*o],[-.5*o,.5*o]]},Z:{position1:[[-1.5*o,-1.5*o],[-.5*o,-1.5*o],[-.5*o,-.5*o],[.5*o,-.5*o]],position2:[[-.5*o,-.5*o],[-.5*o,.5*o],[.5*o,-.5*o],[.5*o,-1.5*o]]}},l={I:{color:"#6EECEE",offsets:[n.I.position1,n.I.position2]},J:{color:"#0000E6",offsets:[n.J.position1,n.J.position2,n.J.position3,n.J.position4]},L:{color:"#E4A439",offsets:[n.L.position1,n.L.position2,n.L.position3,n.L.position4]},O:{color:"#E3E34B",offsets:[n.O.position1]},S:{color:"#6EEC47",offsets:[n.S.position1,n.S.position2]},T:{color:"#921CE7",offsets:[n.T.position1,n.T.position2,n.T.position3,n.T.position4]},Z:{color:"#DC2F21",offsets:[n.Z.position1,n.Z.position2]}},c=document.getElementById("myCanvas"),t={...p(),rotation:0,dy:o/E,lockedCells:[],lockDelayFrame:-1};function S(){let r=l[t.typeCurrent].offsets[t.rotation];if(!r.every(([s,u])=>u+t.yCurrent+t.dy<=o*19))return!1;let i=r.map(([s])=>s+t.xCurrent);return t.lockedCells.filter(({xStart:s})=>i.includes(s)).every(({xStart:s,yStart:u})=>r.every(([f,y])=>!(s<f+t.xCurrent+o&&s+o>f+t.xCurrent&&u<y+t.yCurrent+t.dy+o&&o+u>y+t.yCurrent+t.dy)))}function m(){if(S()){t.yCurrent=t.yCurrent+t.dy;return}if(t.lockDelayFrame===-1){t.lockDelayFrame=0;return}if(t.lockDelayFrame<30){t.lockDelayFrame++;return}t.lockDelayFrame=-1,l[t.typeCurrent].offsets[t.rotation].forEach(([r,i])=>{t.lockedCells.push({color:l[t.typeCurrent].color,xStart:t.xCurrent+r,yStart:t.yCurrent+i})});let e=p();t.xCurrent=e.xCurrent,t.yCurrent=e.yCurrent,t.typeCurrent=e.typeCurrent,t.rotation=0}function x(e,r,i,a){e.fillStyle=r,e.fillRect(i,a,o,o),e.strokeRect(i,a,o,o),e.shadowBlur=20,e.shadowColor="#323232",e.fillRect(i+5,a+5,o-10,o-10),e.shadowBlur=0}function g(e,r,i,a){r.offsets[t.rotation].forEach(([s,u])=>{x(e,r.color,i+s,a+u)})}function C(){let e=c.getContext("2d");e.clearRect(0,0,c.width,c.height),g(e,l[t.typeCurrent],t.xCurrent,t.yCurrent),t.lockedCells.forEach(({color:r,xStart:i,yStart:a})=>{x(e,r,i,a)})}function T(e){return L(e)&&D(e)}function D(e){if(e<0)return!1;let{offsets:r}=l[t.typeCurrent];return t.lockedCells.every(({xStart:i,yStart:a})=>r[t.rotation].every(([s,u])=>!(i<s+e+o&&i+o>s+e&&a<u+t.yCurrent+o&&o+a>u+t.yCurrent)))}function L(e){return l[t.typeCurrent].offsets[t.rotation].every(([r])=>r+e+o<=o*10&&r+e>=0)}function d(){window.addEventListener("keydown",e=>{switch(e.key){case"ArrowRight":T(t.xCurrent+o)&&(t.xCurrent=t.xCurrent+o);return;case"ArrowLeft":T(t.xCurrent-o)&&(t.xCurrent=t.xCurrent-o);return;case"ArrowUp":h();return;default:return}})}function k(){window.requestAnimationFrame(k),m(),C()}d();k();})();
