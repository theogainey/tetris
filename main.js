"use strict";(()=>{function w(){let o=["I","J","L","O","S","T","Z"],e=Math.floor(Math.random()*o.length);return o[e]}function h(o){return o==="I"||o==="O"}function p(){let o=w();return{typeCurrent:o,xCurrent:h(o)?5:4.5,yCurrent:h(o)?1:.5}}var f=30,m=48,n={I:{position1:[[-2,-1],[-1,-1],[0,-1],[1,-1]],position2:[[0,-2],[0,-1],[0,0],[0,1]]},J:{position1:[[-1.5,-1.5],[-1.5,-.5],[-.5,-.5],[.5,-.5]],position2:[[-.5,-1.5],[.5,-1.5],[-.5,-.5],[-.5,.5]],position3:[[-1.5,-.5],[-.5,-.5],[.5,-.5],[.5,.5]],position4:[[-.5,-1.5],[-.5,-.5],[-.5,.5],[-1.5,.5]]},L:{position1:[[-1.5,-.5],[-.5,-.5],[.5,-.5],[.5,-1.5]],position2:[[-.5,-1.5],[-.5,-.5],[-.5,.5],[.5,.5]],position3:[[-1.5,-.5],[-1.5,.5],[-.5,-.5],[.5,-.5]],position4:[[-1.5,-1.5],[-.5,-1.5],[-.5,-.5],[-.5,.5]]},O:{position1:[[-1,-1],[0,-1],[-1,0],[0,0]]},S:{position1:[[-1.5,-.5],[-.5,-.5],[-.5,-1.5],[.5,-1.5]],position2:[[-.5,-1.5],[-.5,-.5],[.5,-.5],[.5,.5]]},T:{position1:[[-1.5,-.5],[-.5,-.5],[-.5,-1.5],[.5,-.5]],position2:[[-.5,-1.5],[-.5,-.5],[.5,-.5],[-.5,.5]],position3:[[-1.5,-.5],[-.5,-.5],[.5,-.5],[-.5,.5]],position4:[[-1.5,-.5],[-.5,-1.5],[-.5,-.5],[-.5,.5]]},Z:{position1:[[-1.5,-1.5],[-.5,-1.5],[-.5,-.5],[.5,-.5]],position2:[[-.5,-.5],[-.5,.5],[.5,-.5],[.5,-1.5]]}},a={I:{color:"#6EECEE",offsets:[n.I.position1,n.I.position2]},J:{color:"#0000E6",offsets:[n.J.position1,n.J.position2,n.J.position3,n.J.position4]},L:{color:"#E4A439",offsets:[n.L.position1,n.L.position2,n.L.position3,n.L.position4]},O:{color:"#E3E34B",offsets:[n.O.position1]},S:{color:"#6EEC47",offsets:[n.S.position1,n.S.position2]},T:{color:"#921CE7",offsets:[n.T.position1,n.T.position2,n.T.position3,n.T.position4]},Z:{color:"#DC2F21",offsets:[n.Z.position1,n.Z.position2]}},C=document.getElementById("myCanvas"),t={...p(),rotation:0,framesTillDrop:m,lockedCells:[],lockDelayFrame:-1};function v(){let e=a[t.typeCurrent].offsets[t.rotation];return e.every(([i,s])=>s+t.yCurrent<19)?e.every(([i,s])=>t.lockedCells.filter(({xStart:r})=>r===i+t.xCurrent).every(({yStart:r})=>s+t.yCurrent+1!==r)):!1}function D(){let i=a[t.typeCurrent].offsets[t.rotation].map(([r,u])=>u+t.yCurrent),s=[...new Set(i)],l=[];s.forEach(r=>{t.lockedCells.filter(({yStart:c})=>c===r).length===10&&(t.lockedCells=t.lockedCells.filter(({yStart:c})=>c!==r),l.push(r))}),t.lockedCells=t.lockedCells.map(r=>{let u=l.filter(c=>c>r.yStart);return{...r,yStart:r.yStart+u.length}})}function y(){if(v()){if(t.framesTillDrop>0&&t.lockDelayFrame===-1){t.framesTillDrop=t.framesTillDrop-1;return}if(t.lockDelayFrame===-1){t.framesTillDrop=m,t.yCurrent=t.yCurrent+1;return}}if(t.lockDelayFrame===-1){t.lockDelayFrame=0;return}if(t.lockDelayFrame<30){t.lockDelayFrame++;return}t.lockDelayFrame=-1,a[t.typeCurrent].offsets[t.rotation].forEach(([e,i])=>{t.lockedCells.push({color:a[t.typeCurrent].color,xStart:t.xCurrent+e,yStart:t.yCurrent+i})}),D();let o=p();t.xCurrent=o.xCurrent,t.yCurrent=o.yCurrent,t.typeCurrent=o.typeCurrent,t.rotation=0}function T(o,e,i,s){let l=i*f,r=s*f;o.fillStyle=e,o.fillRect(l,r,f,f),o.strokeRect(l,r,f,f),o.shadowBlur=20,o.shadowColor="#323232",o.fillRect(l+5,r+5,f-10,f-10),o.shadowBlur=0}function g(o,e,i,s){e.offsets[t.rotation].forEach(([l,r])=>{T(o,e.color,i+l,s+r)})}function d(){let o=C.getContext("2d");o.clearRect(0,0,C.width,C.height),g(o,a[t.typeCurrent],t.xCurrent,t.yCurrent),t.lockedCells.forEach(({color:e,xStart:i,yStart:s})=>{T(o,e,i,s)})}function S(o){return L(o)&&E(o)}function E(o){if(o<0)return!1;let{offsets:e}=a[t.typeCurrent];return e[t.rotation].every(([s,l])=>t.lockedCells.filter(({xStart:u})=>u===o+s).every(({yStart:u})=>l+t.yCurrent!==u))}function L(o){return a[t.typeCurrent].offsets[t.rotation].every(([e])=>e+o<=9&&e+o>=0)}function k(){window.addEventListener("keydown",o=>{switch(o.key){case"ArrowRight":S(t.xCurrent+1)&&(t.xCurrent=t.xCurrent+1);return;case"ArrowLeft":S(t.xCurrent-1)&&(t.xCurrent=t.xCurrent-1);return;case"ArrowUp":let e=t.rotation,i=t.rotation+1;i===a[t.typeCurrent].offsets.length&&(i=0),t.rotation=i,S(t.xCurrent)||(t.rotation=e);return;default:return}})}function x(){window.requestAnimationFrame(x),y(),d()}k();x();})();
