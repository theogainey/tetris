"use strict";(()=>{function w(){let e=["I","J","L","O","S","T","Z"],r=Math.floor(Math.random()*e.length);return e[r]}function x(e){return e==="I"||e==="O"}function c(){let e=w();return{typeCurrent:e,xCurrent:x(e)?5*t:4.5*t,yCurrent:-2*t}}function h(){let e=o.rotation+1;if(e===f[o.typeCurrent].offsets.length){o.rotation=0;return}o.rotation=e}var t=30,g=48,n={I:{position1:[[-2*t,-t],[-t,-t],[0,-t],[t,-t]],position2:[[0,-2*t],[0,-t],[0,0],[0,t]]},J:{position1:[[-1.5*t,-1.5*t],[-1.5*t,-.5*t],[-.5*t,-.5*t],[.5*t,-.5*t]],position2:[[-.5*t,-1.5*t],[.5*t,-1.5*t],[-.5*t,-.5*t],[-.5*t,.5*t]],position3:[[-1.5*t,-.5*t],[-.5*t,-.5*t],[.5*t,-.5*t],[.5*t,.5*t]],position4:[[-.5*t,-1.5*t],[-.5*t,-.5*t],[-.5*t,.5*t],[-1.5*t,.5*t]]},L:{position1:[[-1.5*t,-.5*t],[-.5*t,-.5*t],[.5*t,-.5*t],[.5*t,-1.5*t]],position2:[[-.5*t,-1.5*t],[-.5*t,-.5*t],[-.5*t,.5*t],[.5*t,.5*t]],position3:[[-1.5*t,-.5*t],[-1.5*t,.5*t],[-.5*t,-.5*t],[.5*t,-.5*t]],position4:[[-1.5*t,-1.5*t],[-.5*t,-1.5*t],[-.5*t,-.5*t],[-.5*t,.5*t]]},O:{position1:[[-t,-t],[0,-t],[-t,0],[0,0]]},S:{position1:[[-1.5*t,-.5*t],[-.5*t,-.5*t],[-.5*t,-1.5*t],[.5*t,-1.5*t]],position2:[[-.5*t,-1.5*t],[-.5*t,-.5*t],[.5*t,-.5*t],[.5*t,.5*t]]},T:{position1:[[-1.5*t,-.5*t],[-.5*t,-.5*t],[-.5*t,-1.5*t],[.5*t,-.5*t]],position2:[[-.5*t,-1.5*t],[-.5*t,-.5*t],[.5*t,-.5*t],[-.5*t,.5*t]],position3:[[-1.5*t,-.5*t],[-.5*t,-.5*t],[.5*t,-.5*t],[-.5*t,.5*t]],position4:[[-1.5*t,-.5*t],[-.5*t,-1.5*t],[-.5*t,-.5*t],[-.5*t,.5*t]]},Z:{position1:[[-1.5*t,-1.5*t],[-.5*t,-1.5*t],[-.5*t,-.5*t],[.5*t,-.5*t]],position2:[[-.5*t,-.5*t],[-.5*t,.5*t],[.5*t,-.5*t],[.5*t,-1.5*t]]}},f={I:{color:"#6EECEE",offsets:[n.I.position1,n.I.position2]},J:{color:"#0000E6",offsets:[n.J.position1,n.J.position2,n.J.position3,n.J.position4]},L:{color:"#E4A439",offsets:[n.L.position1,n.L.position2,n.L.position3,n.L.position4]},O:{color:"#E3E34B",offsets:[n.O.position1]},S:{color:"#6EEC47",offsets:[n.S.position1,n.S.position2]},T:{color:"#921CE7",offsets:[n.T.position1,n.T.position2,n.T.position3,n.T.position4]},Z:{color:"#DC2F21",offsets:[n.Z.position1,n.Z.position2]}},p=document.getElementById("myCanvas"),o={...c(),rotation:0,dy:t/g,lockedCells:[],lockDelayFrame:-1};function v(){let r=f[o.typeCurrent].offsets[o.rotation];if(!r.every(([i,l])=>l+o.yCurrent+o.dy<=t*19))return!1;let s=r.map(([i])=>i+o.xCurrent);return o.lockedCells.filter(({xStart:i})=>s.includes(i)).every(({xStart:i,yStart:l})=>r.every(([u,y])=>!(i<u+o.xCurrent+t&&i+t>u+o.xCurrent&&l<y+o.yCurrent+o.dy+t&&t+l>y+o.yCurrent+o.dy)))}function D(){let s=f[o.typeCurrent].offsets[o.rotation].map(([l])=>l+o.yCurrent),i=[...new Set(s)].filter(l=>{if(o.lockedCells.filter(({yStart:u})=>u===l).length===10)return!0});if(i.length>0){let l=Math.min(...i);o.lockedCells=o.lockedCells.filter(({yStart:u})=>!i.includes(u)),o.lockedCells=o.lockedCells.map(u=>l>u.yStart?{...u,yStart:u.yStart+t*i.length}:u)}}function C(){if(v()){o.yCurrent=o.yCurrent+o.dy;return}if(o.lockDelayFrame===-1){o.lockDelayFrame=0;return}if(o.lockDelayFrame<30){o.lockDelayFrame++;return}o.lockDelayFrame=-1,f[o.typeCurrent].offsets[o.rotation].forEach(([r,s])=>{o.lockedCells.push({color:f[o.typeCurrent].color,xStart:o.xCurrent+r,yStart:o.yCurrent+s})}),D();let e=c();o.xCurrent=e.xCurrent,o.yCurrent=e.yCurrent,o.typeCurrent=e.typeCurrent,o.rotation=0}function k(e,r,s,a){e.fillStyle=r,e.fillRect(s,a,t,t),e.strokeRect(s,a,t,t),e.shadowBlur=20,e.shadowColor="#323232",e.fillRect(s+5,a+5,t-10,t-10),e.shadowBlur=0}function E(e,r,s,a){r.offsets[o.rotation].forEach(([i,l])=>{k(e,r.color,s+i,a+l)})}function m(){let e=p.getContext("2d");e.clearRect(0,0,p.width,p.height),E(e,f[o.typeCurrent],o.xCurrent,o.yCurrent),o.lockedCells.forEach(({color:r,xStart:s,yStart:a})=>{k(e,r,s,a)})}function S(e){return R(e)&&L(e)}function L(e){if(e<0)return!1;let{offsets:r}=f[o.typeCurrent];return o.lockedCells.every(({xStart:s,yStart:a})=>r[o.rotation].every(([i,l])=>!(s<i+e+t&&s+t>i+e&&a<l+o.yCurrent+t&&t+a>l+o.yCurrent)))}function R(e){return f[o.typeCurrent].offsets[o.rotation].every(([r])=>r+e+t<=t*10&&r+e>=0)}function d(){window.addEventListener("keydown",e=>{switch(e.key){case"ArrowRight":S(o.xCurrent+t)&&(o.xCurrent=o.xCurrent+t);return;case"ArrowLeft":S(o.xCurrent-t)&&(o.xCurrent=o.xCurrent-t);return;case"ArrowUp":h();return;default:return}})}function T(){window.requestAnimationFrame(T),C(),m()}d();T();})();
