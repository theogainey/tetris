"use strict";(()=>{function u(){let t=["I","J","L","O","S","T","Z"],n=Math.floor(Math.random()*t.length);return t[n]}var e=30,x=48,l={I:{color:"#6EECEE",offsets:[[0,0],[e,0],[e*2,0],[e*3,0]],vertices:[[0,0],[0,e],[e*4,e],[e*4,0]]},J:{color:"#0000E6",offsets:[[0,0],[0,e],[e,e],[e*2,e]],vertices:[[0,0],[0,e*2],[e*3,e*2],[e*3,e],[e,e],[0,e]]},L:{color:"#E4A439",offsets:[[e*2,0],[0,e],[e,e],[e*2,e]],vertices:[[e*2,0],[e*3,0],[e*3,e*2],[0,e*2],[0,e],[e*2,e]]},O:{color:"#E3E34B",offsets:[[0,0],[0,e],[e,0],[e,e]],vertices:[[0,0],[0,e*2],[e*2,e*2],[e*2,0]]},S:{color:"#6EEC47",offsets:[[e*2,0],[e,0],[e,e],[0,e]],vertices:[[0,e],[0,e*2],[e*2,e*2],[e*2,e],[e*3,e],[e*3,0],[e,0],[e,e]]},T:{color:"#921CE7",offsets:[[e,0],[e,e],[0,e],[e*2,e]],vertices:[[e,0],[e,e],[0,e],[0,e*2],[e*3,e*2],[e*3,e],[e*2,e],[e*2,0]]},Z:{color:"#DC2F21",offsets:[[0,0],[e,0],[e,e],[e*2,e]],vertices:[[0,0],[0,e],[e,e],[e,e*2],[e*3,e*2],[e*3,e],[e*2,e],[e*2,0]]}},a=document.getElementById("myCanvas"),r={xCurrent:0,yCurrent:0,typeCurrent:u(),dy:e/x,lockedCells:[],lockDelayFrame:-1};function h(){let{offsets:t}=l[r.typeCurrent];if(!t.every(([o,s])=>s+r.yCurrent+r.dy<=e*19))return!1;let n=t.map(([o])=>o+r.xCurrent);return r.lockedCells.filter(({xStart:o})=>n.includes(o)).every(({xStart:o,yStart:s})=>t.every(([c,f])=>!(o<c+r.xCurrent+e&&o+e>c+r.xCurrent&&s<f+r.yCurrent+r.dy+e&&e+s>f+r.yCurrent+r.dy)))}function m(){if(h()){r.yCurrent=r.yCurrent+r.dy;return}if(r.lockDelayFrame===-1){r.lockDelayFrame=0;return}if(r.lockDelayFrame<30){r.lockDelayFrame++;return}r.lockDelayFrame=-1,console.log(`x ${r.xCurrent} y${r.yCurrent}`),l[r.typeCurrent].offsets.forEach(([t,n])=>{r.lockedCells.push({color:l[r.typeCurrent].color,xStart:r.xCurrent+t,yStart:r.yCurrent+n})}),r.xCurrent=0,r.yCurrent=0,r.typeCurrent=u()}function y(t,n,i,o){t.fillStyle=n,t.fillRect(i,o,e,e),t.strokeRect(i,o,e,e),t.shadowBlur=20,t.shadowColor="#323232",t.fillRect(i+5,o+5,e-10,e-10),t.shadowBlur=0}function k(t,n,i,o){n.offsets.forEach(([s,c])=>{y(t,n.color,i+s,o+c)})}function C(){let t=a.getContext("2d");t.clearRect(0,0,a.width,a.height),k(t,l[r.typeCurrent],r.xCurrent,r.yCurrent),r.lockedCells.forEach(({color:n,xStart:i,yStart:o})=>{y(t,n,i,o)})}function p(t){return D(t)&&E(t)}function E(t){if(t<0)return!1;let{offsets:n}=l[r.typeCurrent];return r.lockedCells.every(({xStart:i,yStart:o})=>n.every(([s,c])=>!(i<s+t+e&&i+e>s+t&&o<c+r.yCurrent+e&&e+o>c+r.yCurrent)))}function D(t){return t<0?!1:l[r.typeCurrent].offsets.every(([n])=>n+t+e<=e*10)}function d(){window.addEventListener("keydown",t=>{switch(t.key){case"ArrowRight":p(r.xCurrent+e)&&(r.xCurrent=r.xCurrent+e);return;case"ArrowLeft":p(r.xCurrent-e)&&(r.xCurrent=r.xCurrent-e);return;default:return}})}function v(){window.requestAnimationFrame(v),m(),C()}d();v();})();
