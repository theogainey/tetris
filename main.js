"use strict";(()=>{function h(){let t=["I","J","L","O","S","T","Z"],n=Math.floor(Math.random()*t.length);return t[n]}function k(t){return t==="I"||t==="O"}function a(){let t=h();return{typeCurrent:t,xCurrent:k(t)?5*e:4.5*e,yCurrent:-2*e}}var e=30,v=48,l={I:{color:"#6EECEE",offsets:[[-2*e,-e],[-e,-e],[0,-e],[e,-e]]},J:{color:"#0000E6",offsets:[[-1.5*e,-1.5*e],[-1.5*e,-.5*e],[-.5*e,-.5*e],[.5*e,-.5*e]]},L:{color:"#E4A439",offsets:[[-1.5*e,-.5*e],[-.5*e,-.5*e],[.5*e,-.5*e],[.5*e,-1.5*e]]},O:{color:"#E3E34B",offsets:[[-e,-e],[0,-e],[-e,0],[0,0]]},S:{color:"#6EEC47",offsets:[[-1.5*e,-.5*e],[-.5*e,-.5*e],[-.5*e,-1.5*e],[.5*e,-1.5*e]]},T:{color:"#921CE7",offsets:[[-1.5*e,-.5*e],[-.5*e,-.5*e],[-.5*e,-1.5*e],[.5*e,-.5*e]]},Z:{color:"#DC2F21",offsets:[[-1.5*e,-1.5*e],[-.5*e,-1.5*e],[-.5*e,-.5*e],[.5*e,-.5*e]]}},c=document.getElementById("myCanvas"),r={...a(),dy:e/v,lockedCells:[],lockDelayFrame:-1};function T(){let{offsets:t}=l[r.typeCurrent];if(!t.every(([o,i])=>i+r.yCurrent+r.dy<=e*19))return!1;let n=t.map(([o])=>o+r.xCurrent);return r.lockedCells.filter(({xStart:o})=>n.includes(o)).every(({xStart:o,yStart:i})=>t.every(([u,m])=>!(o<u+r.xCurrent+e&&o+e>u+r.xCurrent&&i<m+r.yCurrent+r.dy+e&&e+i>m+r.yCurrent+r.dy)))}function f(){if(T()){r.yCurrent=r.yCurrent+r.dy;return}if(r.lockDelayFrame===-1){r.lockDelayFrame=0;return}if(r.lockDelayFrame<30){r.lockDelayFrame++;return}r.lockDelayFrame=-1,console.log(`x ${r.xCurrent} y${r.yCurrent}`),l[r.typeCurrent].offsets.forEach(([n,s])=>{r.lockedCells.push({color:l[r.typeCurrent].color,xStart:r.xCurrent+n,yStart:r.yCurrent+s})});let t=a();r.xCurrent=t.xCurrent,r.yCurrent=t.yCurrent,r.typeCurrent=t.typeCurrent}function y(t,n,s,o){t.fillStyle=n,t.fillRect(s,o,e,e),t.strokeRect(s,o,e,e),t.shadowBlur=20,t.shadowColor="#323232",t.fillRect(s+5,o+5,e-10,e-10),t.shadowBlur=0}function E(t,n,s,o){n.offsets.forEach(([i,u])=>{y(t,n.color,s+i,o+u)})}function C(){let t=c.getContext("2d");t.clearRect(0,0,c.width,c.height),E(t,l[r.typeCurrent],r.xCurrent,r.yCurrent),r.lockedCells.forEach(({color:n,xStart:s,yStart:o})=>{y(t,n,s,o)})}function p(t){return g(t)&&D(t)}function D(t){if(t<0)return!1;let{offsets:n}=l[r.typeCurrent];return r.lockedCells.every(({xStart:s,yStart:o})=>n.every(([i,u])=>!(s<i+t+e&&s+e>i+t&&o<u+r.yCurrent+e&&e+o>u+r.yCurrent)))}function g(t){return l[r.typeCurrent].offsets.every(([n])=>n+t+e<=e*10&&n+t>=0)}function d(){window.addEventListener("keydown",t=>{switch(t.key){case"ArrowRight":p(r.xCurrent+e)&&(r.xCurrent=r.xCurrent+e);return;case"ArrowLeft":p(r.xCurrent-e)&&(r.xCurrent=r.xCurrent-e);return;default:return}})}function x(){window.requestAnimationFrame(x),f(),C()}d();x();})();
