"use strict";(()=>{function a(){let r=["I","J","L","O","S","T","Z"],o=Math.floor(Math.random()*r.length);return r[o]}var t=30,w=48,s={I:{color:"#6EECEE",offsets:[[0,0],[t,0],[t*2,0],[t*3,0]],rightExtreme:t*4,downExtreme:t,vertices:[[0,0],[0,t],[t*4,t],[t*4,0]]},J:{color:"#0000E6",offsets:[[0,0],[0,t],[t,t],[t*2,t]],rightExtreme:t*3,downExtreme:t*2,vertices:[[0,0],[0,t*2],[t*3,t*2],[t*3,t],[t,t],[0,t]]},L:{color:"#E4A439",offsets:[[t*2,0],[0,t],[t,t],[t*2,t]],rightExtreme:t*3,downExtreme:t*2,vertices:[[t*2,0],[t*3,0],[t*3,t*2],[0,t*2],[0,t],[t*2,t]]},O:{color:"#E3E34B",offsets:[[0,0],[0,t],[t,0],[t,t]],rightExtreme:t*2,downExtreme:t*2,vertices:[[0,0],[0,t*2],[t*2,t*2],[t*2,0]]},S:{color:"#6EEC47",offsets:[[t*2,0],[t,0],[t,t],[0,t]],rightExtreme:t*2,downExtreme:t*2,vertices:[[0,t],[0,t*2],[t*2,t*2],[t*2,t],[t*3,t],[t*3,0],[t,0],[t,t]]},T:{color:"#921CE7",offsets:[[t,0],[t,t],[0,t],[t*2,t]],rightExtreme:t*3,downExtreme:t*2,vertices:[[t,0],[t,t],[0,t],[0,t*2],[t*3,t*2],[t*3,t],[t*2,t],[t*2,0]]},Z:{color:"#DC2F21",offsets:[[0,0],[t,0],[t,t],[t*2,t]],rightExtreme:t*3,downExtreme:t*2,vertices:[[0,0],[0,t],[t,t],[t,t*2],[t*3,t*2],[t*3,t],[t*2,t],[t*2,0]]}},c=document.getElementById("myCanvas"),e={xCurrent:0,yCurrent:0,typeCurrent:a(),dy:t/w,lockedTetrominos:[],lockedCells:[],collisionPath:new Map};function v(r,o){let n=Math.min(...o);return r<n}function P(){let{offsets:r}=s[e.typeCurrent];return r.map(([n,i])=>({y:i+t+e.yCurrent,xStart:n+e.xCurrent,xEnd:n+t+e.xCurrent})).every(({xStart:n,xEnd:i,y:l})=>{var d,x;let m=(d=e.collisionPath.get(n))!=null?d:[t*20],E=(x=e.collisionPath.get(i))!=null?x:[t*20],y=m.filter(g=>E.includes(g));return v(l,y)})}function u(){if(P()){e.yCurrent=e.yCurrent+e.dy;return}s[e.typeCurrent].offsets.forEach(([r,o])=>{e.lockedCells.push({color:s[e.typeCurrent].color,xStart:e.xCurrent+r,yStart:e.yCurrent+o})}),s[e.typeCurrent].offsets.forEach(([r,o])=>{let n=e.collisionPath.get(r+e.xCurrent),i=e.collisionPath.get(r+t+e.xCurrent);n?e.collisionPath.set(r+e.xCurrent,n.concat(o+e.yCurrent)):e.collisionPath.set(r+e.xCurrent,[o+e.yCurrent]),i?e.collisionPath.set(r+t+e.xCurrent,i.concat(o+e.yCurrent)):e.collisionPath.set(r+t+e.xCurrent,[o+e.yCurrent])}),e.xCurrent=0,e.yCurrent=0,e.typeCurrent=a()}function h(r,o,n,i){r.beginPath(),r.rect(n,i,t,t),r.fillStyle=o,r.fill(),r.stroke(),r.closePath()}function S(r,o,n,i){o.offsets.forEach(([l,m])=>{h(r,o.color,n+l,i+m)})}function C(){let r=c.getContext("2d");r.clearRect(0,0,c.width,c.height),S(r,s[e.typeCurrent],e.xCurrent,e.yCurrent),e.lockedCells.forEach(({color:o,xStart:n,yStart:i})=>{h(r,o,n,i)})}function T(r){switch(r){case"ArrowRight":return e.xCurrent+s[e.typeCurrent].rightExtreme<t*10;case"ArrowLeft":return e.xCurrent-t>=0;default:return!1}}function k(r){switch(r){case"ArrowRight":e.xCurrent=e.xCurrent+t;break;case"ArrowLeft":e.xCurrent=e.xCurrent-t;break;default:e.xCurrent=e.xCurrent-t;break}}function f(){window.addEventListener("keydown",r=>{T(r.key)&&k(r.key)})}function p(){window.requestAnimationFrame(p),u(),C()}f();p();})();
//# sourceMappingURL=main.js.map
