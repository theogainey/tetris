"use strict";(()=>{function c(){let t=["I","J","L","O","S","T","Z"],n=Math.floor(Math.random()*t.length);return t[n]}var e=30,x=48,l={I:{color:"#6EECEE",offsets:[[0,0],[e,0],[e*2,0],[e*3,0]],vertices:[[0,0],[0,e],[e*4,e],[e*4,0]]},J:{color:"#0000E6",offsets:[[0,0],[0,e],[e,e],[e*2,e]],vertices:[[0,0],[0,e*2],[e*3,e*2],[e*3,e],[e,e],[0,e]]},L:{color:"#E4A439",offsets:[[e*2,0],[0,e],[e,e],[e*2,e]],vertices:[[e*2,0],[e*3,0],[e*3,e*2],[0,e*2],[0,e],[e*2,e]]},O:{color:"#E3E34B",offsets:[[0,0],[0,e],[e,0],[e,e]],vertices:[[0,0],[0,e*2],[e*2,e*2],[e*2,0]]},S:{color:"#6EEC47",offsets:[[e*2,0],[e,0],[e,e],[0,e]],vertices:[[0,e],[0,e*2],[e*2,e*2],[e*2,e],[e*3,e],[e*3,0],[e,0],[e,e]]},T:{color:"#921CE7",offsets:[[e,0],[e,e],[0,e],[e*2,e]],vertices:[[e,0],[e,e],[0,e],[0,e*2],[e*3,e*2],[e*3,e],[e*2,e],[e*2,0]]},Z:{color:"#DC2F21",offsets:[[0,0],[e,0],[e,e],[e*2,e]],vertices:[[0,0],[0,e],[e,e],[e,e*2],[e*3,e*2],[e*3,e],[e*2,e],[e*2,0]]}},f=document.getElementById("myCanvas"),r={xCurrent:0,yCurrent:0,typeCurrent:c(),dy:e/x,lockedCells:[]};function h(){let{offsets:t}=l[r.typeCurrent];if(!t.every(([o,i])=>i+r.yCurrent+r.dy<=e*19))return!1;let n=t.map(([o])=>o+r.xCurrent);return r.lockedCells.filter(({xStart:o})=>n.includes(o)).every(({xStart:o,yStart:i})=>t.every(([u,a])=>!(o<u+r.xCurrent+e&&o+e>u+r.xCurrent&&i<a+r.yCurrent+r.dy+e&&e+i>a+r.yCurrent+r.dy)))}function m(){if(h()){r.yCurrent=r.yCurrent+r.dy;return}console.log(`x ${r.xCurrent} y${r.yCurrent}`),l[r.typeCurrent].offsets.forEach(([t,n])=>{r.lockedCells.push({color:l[r.typeCurrent].color,xStart:r.xCurrent+t,yStart:r.yCurrent+n})}),r.xCurrent=0,r.yCurrent=0,r.typeCurrent=c()}function y(t,n,s,o){t.fillStyle=n,t.fillRect(s,o,e,e),t.strokeRect(s,o,e,e),t.shadowBlur=20,t.shadowColor="#000000",t.fillRect(s+5,o+5,e-10,e-10),t.shadowBlur=0}function E(t,n,s,o){n.offsets.forEach(([i,u])=>{y(t,n.color,s+i,o+u)})}function C(){let t=f.getContext("2d");t.clearRect(0,0,f.width,f.height),E(t,l[r.typeCurrent],r.xCurrent,r.yCurrent),r.lockedCells.forEach(({color:n,xStart:s,yStart:o})=>{y(t,n,s,o)})}function p(t){return g(t)&&T(t)}function T(t){if(t<0)return!1;let{offsets:n}=l[r.typeCurrent];return r.lockedCells.every(({xStart:s,yStart:o})=>n.every(([i,u])=>!(s<i+t+e&&s+e>i+t&&o<u+r.yCurrent+e&&e+o>u+r.yCurrent)))}function g(t){return t<0?!1:l[r.typeCurrent].offsets.every(([n])=>n+t+e<=e*10)}function d(){window.addEventListener("keydown",t=>{switch(t.key){case"ArrowRight":p(r.xCurrent+e)&&(r.xCurrent=r.xCurrent+e);return;case"ArrowLeft":p(r.xCurrent-e)&&(r.xCurrent=r.xCurrent-e);return;default:return}})}function v(){window.requestAnimationFrame(v),m(),C()}d();v();})();
