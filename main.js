"use strict";(()=>{function c(){let o=["I","J","L","O","S","T","Z"],r=Math.floor(Math.random()*o.length);return o[r]}var t=30,E=48,s={I:{color:"#6EECEE",offsets:[[0,0],[t,0],[t*2,0],[t*3,0]],vertices:[[0,0],[0,t],[t*4,t],[t*4,0]]},J:{color:"#0000E6",offsets:[[0,0],[0,t],[t,t],[t*2,t]],vertices:[[0,0],[0,t*2],[t*3,t*2],[t*3,t],[t,t],[0,t]]},L:{color:"#E4A439",offsets:[[t*2,0],[0,t],[t,t],[t*2,t]],vertices:[[t*2,0],[t*3,0],[t*3,t*2],[0,t*2],[0,t],[t*2,t]]},O:{color:"#E3E34B",offsets:[[0,0],[0,t],[t,0],[t,t]],vertices:[[0,0],[0,t*2],[t*2,t*2],[t*2,0]]},S:{color:"#6EEC47",offsets:[[t*2,0],[t,0],[t,t],[0,t]],vertices:[[0,t],[0,t*2],[t*2,t*2],[t*2,t],[t*3,t],[t*3,0],[t,0],[t,t]]},T:{color:"#921CE7",offsets:[[t,0],[t,t],[0,t],[t*2,t]],vertices:[[t,0],[t,t],[0,t],[0,t*2],[t*3,t*2],[t*3,t],[t*2,t],[t*2,0]]},Z:{color:"#DC2F21",offsets:[[0,0],[t,0],[t,t],[t*2,t]],vertices:[[0,0],[0,t],[t,t],[t,t*2],[t*3,t*2],[t*3,t],[t*2,t],[t*2,0]]}},u=document.getElementById("myCanvas"),e={xCurrent:0,yCurrent:0,typeCurrent:c(),dy:t/E,lockedTetrominos:[],lockedCells:[],verticalCollisionPoints:new Map,horizontalCollisionPoints:new Map};function P(o,r){let n=Math.min(...r);return o<n}function T(){let{offsets:o}=s[e.typeCurrent];return o.map(([n,i])=>({y:i+t+e.yCurrent,xStart:n+e.xCurrent,xEnd:n+t+e.xCurrent})).every(({xStart:n,xEnd:i,y:l})=>{var p,v;let a=(p=e.verticalCollisionPoints.get(n))!=null?p:[t*20],d=(v=e.verticalCollisionPoints.get(i))!=null?v:[t*20],x=a.filter(g=>d.includes(g));return P(l,x)})}function C(){if(T()){e.yCurrent=e.yCurrent+e.dy;return}s[e.typeCurrent].offsets.forEach(([o,r])=>{e.lockedCells.push({color:s[e.typeCurrent].color,xStart:e.xCurrent+o,yStart:e.yCurrent+r})}),s[e.typeCurrent].offsets.forEach(([o,r])=>{let n=e.verticalCollisionPoints.get(o+e.xCurrent),i=e.verticalCollisionPoints.get(o+t+e.xCurrent);n?e.verticalCollisionPoints.set(o+e.xCurrent,n.concat(r+e.yCurrent)):e.verticalCollisionPoints.set(o+e.xCurrent,[r+e.yCurrent]),i?e.verticalCollisionPoints.set(o+t+e.xCurrent,i.concat(r+e.yCurrent)):e.verticalCollisionPoints.set(o+t+e.xCurrent,[r+e.yCurrent])}),e.xCurrent=0,e.yCurrent=0,e.typeCurrent=c()}function y(o,r,n,i){o.beginPath(),o.rect(n,i,t,t),o.fillStyle=r,o.fill(),o.stroke(),o.closePath()}function k(o,r,n,i){r.offsets.forEach(([l,a])=>{y(o,r.color,n+l,i+a)})}function m(){let o=u.getContext("2d");o.clearRect(0,0,u.width,u.height),k(o,s[e.typeCurrent],e.xCurrent,e.yCurrent),e.lockedCells.forEach(({color:r,xStart:n,yStart:i})=>{y(o,r,n,i)})}function S(o){return w(o)&&b(o)}function b(o){if(o<0)return!1;let{offsets:r}=s[e.typeCurrent];return e.lockedCells.every(({xStart:n,yStart:i})=>r.every(([l,a])=>!(n<l+o+t&&n+t>l+o&&i<a+e.yCurrent+t&&t+i>a+e.yCurrent)))}function w(o){return o<0?!1:s[e.typeCurrent].offsets.every(([r])=>r+o+t<=t*10)}function f(){window.addEventListener("keydown",o=>{let r=0;switch(o.key){case"ArrowRight":r=e.xCurrent+t;break;case"ArrowLeft":r=e.xCurrent-t;break;default:break}S(r)&&(e.xCurrent=r)})}function h(){window.requestAnimationFrame(h),C(),m()}f();h();})();
